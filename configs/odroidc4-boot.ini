ODROIDC4-UBOOT-CONFIG

#------------------------------------------------------------------------------------------------------
#
# boot.ini
#
# PLEASE DO NOT MODIFY THIS FILE! ALL CHANGES WILL BE LOST WITH A VOLUMIO UPDATE!
# Set your own settings in user.boot.ini, see sample file in /boot
#
#------------------------------------------------------------------------------------------------------

setenv board "odroidc4"
setenv heartbeat "1"
setenv condev "console=ttyS0,115200n8"   # on both
setenv monitor_onoff "false" # true or false
setenv overscan "100"
setenv voutmode "hdmi"
# setenv voutmode "dvi"
setenv sdrmode "auto"
setenv disablehpd "false"
setenv disable_vu7 "true"
setenv max_freq_a55 "1908"    # 1.908 GHz, default value
setenv maxcpus "4"
setenv enable_wol "0"
setenv dactype "none"
setenv ftd-resized "false"
setenv verbosity "0"
setenv gpiopower "479"

# Set load addresses
setenv dtb_loadaddr "0x10000000"
setenv dtbo_addr_r "0x11000000"
setenv k_addr "0x1100000"
setenv loadaddr "0x1B00000"
setenv initrd_loadaddr "0x3700000"
setenv overlay_resize "16384"

# Read generic config.ini params (except DACs, they go into volumio's user.boot.ini!!!)
load mmc ${devno}:1 ${loadaddr} config.ini \
    && ini generic ${loadaddr}

# Read overlay-profile configuration (if any)
if test "x${overlay_profile}" != "x"; then
    ini overlay_${overlay_profile} ${loadaddr}
fi

echo "[Volumio INFO] Reading Volumio & User defined environment parameters (if any)"
load mmc ${devno}:1 ${loadaddr} user.boot.ini \
    && ini generic ${loadaddr}

# Volumio Parameters
setenv hwdevice "Odroid-C4"
setenv volumiouuids "%%VOLUMIO-PARAMS%%"
setenv volumioargs "imgfile=/volumio_current.sqsh uuidconfig=boot.ini loglevel=$verbosity hwdevice=${hwdevice} bootdelay=5"

### Normal HDMI Monitors
if test "${display_autodetect}" = "true"; then hdmitx edid; fi
if test "${hdmimode}" = "custombuilt"; then setenv cmode "modeline=${modeline}"; fi
if test "${cec}" = "true"; then setenv cec_enable "hdmitx=cec3f"; fi
if test "${disable_vu7}" = "false"; then setenv hid_quirks "usbhid.quirks=0x0eef:0x0005:0x0004"; fi

# Boot Args
setenv bootargs "${volumiouuids} ${volumioargs} ${condev} ${amlogic} no_console_suspend fsck.repair=yes net.ifnames=0 elevator=noop hdmimode=${hdmimode} cvbsmode=576cvbs max_freq_a55=${max_freq_a55} maxcpus=${maxcpus} voutmode=${voutmode} ${cmode} disablehpd=${disablehpd} cvbscable=${cvbscable} overscan=${overscan} ${hid_quirks} monitor_onoff=${monitor_onoff} logo=osd0,loaded ${cec_enable} sdrmode=${sdrmode} enable_wol=${enable_wol}"

# Load kernel, dtb and initrd
fatload mmc ${devno}:1 ${k_addr} Image.gz
fatload mmc ${devno}:1 ${dtb_loadaddr} amlogic/meson64_odroidc4.dtb
fatload mmc ${devno}:1 ${initrd_loadaddr} uInitrd
fdt addr ${dtb_loadaddr}

if test "x{overlays}" != "x"; then
    fdt resize ${overlay_resize}
    setenv fdt-resized "true"
    for overlay in ${overlays}; do
        load mmc ${devno}:1 ${dtbo_addr_r} amlogic/overlays/${board}/${overlay}.dtbo \
            && fdt apply ${dtbo_addr_r}
    done
fi

# Modify led trigger mode
if test "${heartbeat}" = "0"; then
  fdt set /leds/blueled linux,default-trigger "none";
fi

# DAC configuration
if test "${dactype}" != "none"; then
  if test "${fdt-resized}" != "true"; then
    fdt resize ${overlay_resize}
  fi
  if test "${dactype}" = "ODROID-HIFI"; then
    echo "[Volumio INFO] Enabling Hifi Shield/ Shield+ (or custom dac)";
    load mmc ${devno}:1 ${dtbo_addr_r} amlogic/overlays/${board}/hifishield.dtbo \
            && fdt apply ${dtbo_addr_r}
    echo "[Volumio INFO] Hifi Shield enabled"
  else
#   assume ODROID-HIFI2
    echo "[Volumio INFO] Enabling Hifi Shield 2"
    load mmc ${devno}:1 ${dtbo_addr_r} amlogic/overlays/${board}/hifishield2.dtbo \
            && fdt apply ${dtbo_addr_r}
    echo "[Volumio INFO] Hifi Shield 2 enabled"
  fi
fi

# unzip the kernel
unzip ${k_addr} ${loadaddr}
# boot
booti ${loadaddr} ${initrd_loadaddr} ${dtb_loadaddr}
